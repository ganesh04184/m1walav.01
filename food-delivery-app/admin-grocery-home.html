<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Grocery</title>
    <style>
        /* Your existing styles */
        .product {
            margin-bottom: 20px;
            padding: 20px;
            background-color: #f9f9f9;
            border-radius: 5px;
        }

        .product h3 {
            margin-bottom: 10px;
        }

        .product p {
            margin-bottom: 5px;
        }

        .product img {
            max-width: 100px;
            height: auto;
            margin-bottom: 10px;
        }

        .product-actions {
            margin-top: 10px;
            display: flex;
            justify-content: space-between;
        }

        .product-actions button {
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .product-actions button.edit {
            background-color: #007bff;
            color: white;
            margin-right: 10px;
        }

        .product-actions button.delete {
            background-color: #dc3545;
            color: white;
        }

        .product-actions button.toggle {
            background-color: #ffc107;
            color: white;
        }

        #product-form {
            display: none;
        }
        
        .quantity-group {
            display: flex;
            gap: 10px;
        }

        .quantity-group select,
        .quantity-group input {
            flex: 1;
        }

        .quantity-entry {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        #form-message {
            margin-top: 10px;
            color: green;
        }
    </style>
</head>
<body>
    <header>
        <h1>Admin - Add Product</h1>
    </header>
    <main>
        <button id="add-product-btn">Add Product</button>

        <form id="product-form" enctype="multipart/form-data">
            <label for="name">Product Name:</label>
            <input type="text" id="name" name="name" required>
            
            <label for="category">Category:</label>
            <input type="text" id="category" name="category" required>
            
            <label for="subcategory">Subcategory:</label>
            <input type="text" id="subcategory" name="subcategory" required>
            
            <label for="image">Image:</label>
            <input type="file" id="image" name="image" accept="image/*" required>
            
            <label for="originalPrice">Original Price:</label>
            <input type="text" id="originalPrice" name="originalPrice" required>
            
            <label for="discountedPrice">Discounted Price:</label>
            <input type="text" id="discountedPrice" name="discountedPrice" required>
            
            <label for="time">Delivery Time:</label>
            <input type="text" id="time" name="time" required>
            
            <label>Quantities:</label>
            <div id="quantity-container">
                <div class="quantity-entry">
                    <select class="quantity-unit" name="quantity-unit[]" required>
                        <option value="kg">kg</option>
                        <option value="grams">grams</option>
                        <option value="units">units</option>
                        <option value="ml">ml</option>
                    </select>
                    <input type="number" class="quantity-value" name="quantity-value[]" min="1" required>
                    <input type="text" class="quantity-price" name="quantity-price[]" placeholder="Price" required>
                    <button type="button" class="remove-quantity">Remove</button>
                </div>
            </div>
            <button type="button" id="add-quantity">Add Another Quantity</button>
            
            <button type="submit">Add Product</button>
            <div id="form-message"></div>
        </form>
        
        <div class="product-list" id="product-list">
            <!-- Existing products will be displayed here -->
        </div>
    </main>
    <script>
        document.getElementById('add-product-btn').addEventListener('click', function() {
            document.getElementById('product-form').style.display = 'block';
        });

        document.getElementById('add-quantity').addEventListener('click', function() {
            const quantityContainer = document.getElementById('quantity-container');
            const quantityEntry = document.createElement('div');
            quantityEntry.classList.add('quantity-entry');
            quantityEntry.innerHTML = `
                <select class="quantity-unit" name="quantity-unit[]" required>
                    <option value="kg">kg</option>
                    <option value="grams">grams</option>
                    <option value="units">units</option>
                    <option value="ml">ml</option>
                </select>
                <input type="number" class="quantity-value" name="quantity-value[]" min="1" required>
                <input type="text" class="quantity-price" name="quantity-price[]" placeholder="Price" required>
                <button type="button" class="remove-quantity">Remove</button>
            `;
            quantityEntry.querySelector('.remove-quantity').addEventListener('click', function() {
                quantityContainer.removeChild(quantityEntry);
            });
            quantityContainer.appendChild(quantityEntry);
        });

        async function fetchProducts() {
            const response = await fetch('https://m1wala1.onrender.com/products');
            const products = await response.json();
            displayProducts(products);
        }

        async function deleteProduct(id) {
            await fetch(`http://localhost:3000/product/${id}`, { method: 'DELETE' });
            fetchProducts();
        }

        async function toggleAvailability(id) {
            await fetch(`http://localhost:3000/product/${id}/toggle-availability`, { method: 'PATCH' });
            fetchProducts();
        }

        function displayProducts(products) {
            const productList = document.getElementById('product-list');
            productList.innerHTML = '';

            products.forEach((product) => {
                const productDiv = document.createElement('div');
                productDiv.classList.add('product');
                productDiv.innerHTML = `
                    <h3>${product.name}</h3>
                    <p><strong>Category:</strong> ${product.category}</p>
                    <p><strong>Subcategory:</strong> ${product.subcategory}</p>
                    <p><strong>Original Price:</strong> ${product.originalPrice}</p>
                    <p><strong>Discounted Price:</strong> ${product.discountedPrice}</p>
                    <p><strong>Delivery Time:</strong> ${product.time}</p>
                    ${product.quantities.map(quantity => `
                        <p><strong>Quantity:</strong> ${quantity.quantityValue} ${quantity.quantityUnit} - ${quantity.price}</p>
                    `).join('')}
                    <img src="${product.image}" alt="${product.name}">
                    <div class="product-actions">
                        <button class="edit" onclick="editProduct('${product._id}')">Edit</button>
                        <button class="delete" onclick="deleteProduct('${product._id}')">Delete</button>
                        <button class="toggle" onclick="toggleAvailability('${product._id}')">${product.available ? 'Mark as Unavailable' : 'Mark as Available'}</button>
                    </div>
                `;
                productList.appendChild(productDiv);
            });
        }

        document.getElementById('product-form').addEventListener('submit', async function(event) {
            event.preventDefault();

            const formData = new FormData();
            formData.append('name', document.getElementById('name').value);
            formData.append('category', document.getElementById('category').value);
            formData.append('subcategory', document.getElementById('subcategory').value);
            formData.append('image', document.getElementById('image').files[0]);
            formData.append('originalPrice', document.getElementById('originalPrice').value);
            formData.append('discountedPrice', document.getElementById('discountedPrice').value);
            formData.append('time', document.getElementById('time').value);
            
            const quantities = Array.from(document.querySelectorAll('#quantity-container .quantity-entry')).map(entry => ({
                quantityUnit: entry.querySelector('.quantity-unit').value,
                quantityValue: entry.querySelector('.quantity-value').value,
                price: entry.querySelector('.quantity-price').value,
            }));

            formData.append('quantities', JSON.stringify(quantities));

            const response = await fetch('https://m1wala1.onrender.com/add-product', {
                method: 'POST',
                body: formData
            });

            const result = await response.json();
            document.getElementById('form-message').textContent = result.success ? 'Product added successfully!' : 'Failed to add product';
            fetchProducts();
        });

        fetchProducts();
    </script>
</body>
</html>
