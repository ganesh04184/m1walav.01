<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grocery Shopping</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }

        header {
            background-color: #f8f8f8;
            padding: 10px;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        #search {
            padding: 5px;
            width: 80%;
            margin-top: 10px;
        }

        nav ul {
            list-style-type: none;
            padding: 0;
            background-color: #333;
            overflow: hidden;
        }

        nav ul li {
            float: left;
        }

        nav ul li a {
            display: block;
            padding: 10px;
            color: white;
            text-align: center;
            text-decoration: none;
        }

        nav ul li a:hover {
            background-color: #111;
        }

        main {
            display: flex;
            padding: 10px;
        }

        aside {
            width: 20%;
        }

        aside ul {
            list-style-type: none;
            padding: 0;
        }

        aside ul li {
            margin-bottom: 10px;
        }

        aside ul li a {
            text-decoration: none;
            color: #333;
            display: block;
            padding: 10px;
            background-color: #f8f8f8;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        aside ul li a:hover {
            background-color: #ddd;
        }

        .product-grid {
            width: 80%;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            padding-left: 20px;
        }

        .product-item {
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            text-align: center;
            background-color: #fff;
            position: relative;
        }

        .product-item img {
            max-width: 100%;
            height: auto;
            border-bottom: 1px solid #ddd;
            padding-bottom: 10px;
            margin-bottom: 10px;
        }

        .product-item .discount {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: #ff5c5c;
            color: white;
            padding: 5px;
            border-radius: 5px;
            font-weight: bold;
        }

        .product-item .prices {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }

        .product-item .original-price {
            text-decoration: line-through;
            color: #888;
        }

        .product-item .discounted-price {
            color: #28a745;
            font-weight: bold;
        }

        .product-item button {
            background-color: #28a745;
            color: white;
            border: none;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
        }

        .product-item button:hover {
            background-color: #218838;
        }

        .product-item.unavailable {
            background-color: #f8d7da;
            opacity: 0.6;
            pointer-events: none;
        }

        .product-item .not-available {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: rgba(255, 255, 255, 0.8);
            color: red;
            font-size: 1.5em;
        }

        form {
            display: flex;
            flex-direction: column;
            max-width: 400px;
            margin: 20px auto;
        }

        form label {
            margin-top: 10px;
        }

        form input {
            padding: 5px;
            margin-top: 5px;
        }

        form button {
            margin-top: 20px;
            padding: 10px;
            background-color: #007bff;
            color: white;
            border: none;
            cursor: pointer;
        }

        form button:hover {
            background-color: #0056b3;
        }

        .navbar-menu {
            background-color: rgba(var(--white), 1);
            position: fixed;
            bottom: 0;
            width: 100%;
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.1);
            z-index: 1000;
        }

        .navbar-menu ul {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            width: 100%;
            justify-content: space-around;
        }

        .navbar-menu li {
            flex: 1;
            text-align: center;
        }

        .navbar-menu a {
            color: rgba(34, 139, 34);
            text-decoration: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .navbar-menu a.active {
            color: rgba(var(--light-theme-color), 1);
        }

        .navbar-menu img {
            max-width: 24px;
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <header>
        <h1>Grocery Shopping</h1>
        <input type="text" id="search" placeholder="Search...">
    </header>
    <nav>
        <ul id="categories">
            <li data-category="vegetables-fruits"><a href="#">Vegetables & Fruits</a></li>
            <li data-category="dairy"><a href="#">Dairy</a></li>
            <li data-category="meat"><a href="#">Meat</a></li>
        </ul>
    </nav>
    <main>
        <aside id="subcategories"></aside>
        <section class="product-grid"></section>
    </main>
    <!-- Bottom Navbar -->
    <div class="navbar-menu">
        <ul>
            <li class="active">
                <a href="grocery-home.html" class="icon">
                    <img class="unactive" src="../assets/images/svg/grocery.svg" alt="grocery">
                    <span>Grocery</span>
                </a>
            </li>
            <li>
                <a href="cart.html" class="icon">
                    <img class="unactive" src="../assets/images/svg/user.svg" alt="cart">
                    <span>Cart</span>
                </a>
            </li>
            <li>
                <a href="profile.html" class="icon">
                    <img class="unactive" src="../assets/images/svg/user.svg" alt="user">
                    <span>Profile</span>
                </a>
            </li>
        </ul>
    </div>

    <script>
        const subcategories = {
            "vegetables-fruits": ["Leafy Greens", "Root Vegetables", "Fruits", "Seasonal Fruits"],
            "dairy": ["Milk", "Curd", "Ghee"],
            "meat": ["Country Chicken", "Mutton", "Fish"]
        };

        function renderSubcategories(category) {
            const subcategoryList = document.getElementById('subcategories');
            subcategoryList.innerHTML = '';

            if (subcategories[category]) {
                const subcategoryUl = document.createElement('ul');
                subcategories[category].forEach(subcategory => {
                    const li = document.createElement('li');
                    li.innerHTML = `<a href="#" onclick="renderProductsBySubcategory('${subcategory}')">${subcategory}</a>`;
                    subcategoryUl.appendChild(li);
                });
                subcategoryList.appendChild(subcategoryUl);
            }
        }

        async function fetchProducts() {
            const response = await fetch('http://localhost:3000/products');
            const products = await response.json();
            return products;
        }

        function calculateDiscountPercentage(originalPrice, discountedPrice) {
            const discount = originalPrice - discountedPrice;
            const percentage = (discount / originalPrice) * 100;
            return Math.round(percentage);
        }

        async function renderProductsBySubcategory(subcategory) {
    const products = await fetchProducts();
    const productGrid = document.querySelector('.product-grid');
    productGrid.innerHTML = '';

    const filteredProducts = products.filter(product => product.subcategory === subcategory);
    if (filteredProducts.length === 0) {
        productGrid.innerHTML = '<p>No products found in this subcategory.</p>';
    } else {
        filteredProducts.forEach(product => {
            // Parse originalPrice and discountedPrice into numbers
            const originalPrice = parseFloat(product.originalPrice);
            const discountedPrice = parseFloat(product.discountedPrice);

            if (isNaN(originalPrice) || isNaN(discountedPrice)) {
                console.error('Invalid price data', product);
                return;
            }

            const discountPercentage = calculateDiscountPercentage(originalPrice, discountedPrice);

            const productItem = document.createElement('div');
            productItem.className = 'product-item';

            const productImage = document.createElement('img');
            productImage.src = product.image; // Use 'image' instead of 'imageUrl'
            productImage.alt = product.name;

            const productName = document.createElement('h3');
            productName.textContent = product.name;

            const discountBadge = document.createElement('div');
            discountBadge.className = 'discount';
            discountBadge.textContent = `${discountPercentage}% OFF`;

            const pricesDiv = document.createElement('div');
            pricesDiv.className = 'prices';

            const originalPriceElement = document.createElement('span');
            originalPriceElement.className = 'original-price';
            originalPriceElement.textContent = `₹${originalPrice.toFixed(2)}`;

            const discountedPriceElement = document.createElement('span');
            discountedPriceElement.className = 'discounted-price';
            discountedPriceElement.textContent = `₹${discountedPrice.toFixed(2)}`;

            const productButton = document.createElement('button');
            productButton.textContent = 'Add to Cart';
            productButton.onclick = () => alert(`Added ${product.name} to cart!`);

            productItem.appendChild(discountBadge);
            productItem.appendChild(productImage);
            productItem.appendChild(productName);
            pricesDiv.appendChild(originalPriceElement);
            pricesDiv.appendChild(discountedPriceElement);
            productItem.appendChild(pricesDiv);
            productItem.appendChild(productButton);

            productGrid.appendChild(productItem);
        });
    }
}


        document.addEventListener('DOMContentLoaded', () => {
            const categories = document.querySelectorAll('nav ul li a');
            categories.forEach(category => {
                category.addEventListener('click', (e) => {
                    e.preventDefault();
                    const selectedCategory = e.target.parentElement.getAttribute('data-category');
                    renderSubcategories(selectedCategory);
                });
            });

            renderProductsBySubcategory('Leafy Greens'); // Default subcategory to show on page load
        });

        document.getElementById('search').addEventListener('input', async (e) => {
            const searchQuery = e.target.value.toLowerCase();
            const products = await fetchProducts();
            const productGrid = document.querySelector('.product-grid');
            productGrid.innerHTML = '';

            const filteredProducts = products.filter(product => 
                product.name.toLowerCase().includes(searchQuery) ||
                product.subcategory.toLowerCase().includes(searchQuery)
            );

            if (filteredProducts.length === 0) {
                productGrid.innerHTML = '<p>No products found.</p>';
            } else {
                filteredProducts.forEach(product => {
                    if (typeof product.originalPrice !== 'number' || typeof product.discountedPrice !== 'number') {
                        console.error('Invalid price data', product);
                        return;
                    }

                    const discountPercentage = calculateDiscountPercentage(product.originalPrice, product.discountedPrice);

                    const productItem = document.createElement('div');
                    productItem.className = 'product-item';

                    const productImage = document.createElement('img');
                    productImage.src = product.imageUrl;
                    productImage.alt = product.name;

                    const productName = document.createElement('h3');
                    productName.textContent = product.name;

                    const discountBadge = document.createElement('div');
                    discountBadge.className = 'discount';
                    discountBadge.textContent = `${discountPercentage}% OFF`;

                    const pricesDiv = document.createElement('div');
                    pricesDiv.className = 'prices';

                    const originalPrice = document.createElement('span');
                    originalPrice.className = 'original-price';
                    originalPrice.textContent = `$${product.originalPrice.toFixed(2)}`;

                    const discountedPrice = document.createElement('span');
                    discountedPrice.className = 'discounted-price';
                    discountedPrice.textContent = `$${product.discountedPrice.toFixed(2)}`;

                    const productButton = document.createElement('button');
                    productButton.textContent = 'Add to Cart';
                    productButton.onclick = () => alert(`Added ${product.name} to cart!`);

                    productItem.appendChild(discountBadge);
                    productItem.appendChild(productImage);
                    productItem.appendChild(productName);
                    productItem.appendChild(pricesDiv);
                    productItem.appendChild(productButton);

                    productGrid.appendChild(productItem);
                });
            }
        });
    </script>
</body>
</html>


                   
